import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as c}from"./index.C1SLTdIO.js";import{I as R,S as k}from"./index.loRFk-AH.js";import{a as C}from"./app-config.zEQo3iYE.js";import{l as r}from"./locale_text_site.BvdD-9Qv.js";import{Y as _}from"./index.CqrHhE94.js";import{s as E}from"./seo-data-site.CLNeXSAF.js";import{t as x}from"./contact-us.D-J7bnCy.js";import{R as $}from"./index.n-Ca5uiV.js";import"./iconBase.10d0k-hK.js";const M=async m=>{const{name:i,phone:p,email:t,message:f,orderDataSendTelegram:g,delivery:o}=m,a=`
    Новый ЗАКАЗ:
    Имя: ${i}
    Телефон: ${p}
    Email: ${t}
    Продукт: ${g.title}
    Цена со скидкой: ${g.discountedPrice}
    Данные по доставке: ${o}
    Дополнительная информация: ${f}
  `,h=`https://api.telegram.org/bot${C.TOKEN_TELEGRAM}/sendMessage`;try{if(!(await fetch(h,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chat_id:C.CHAT_ID_TELEGRAM,text:a,parse_mode:"HTML"})})).ok)throw new Error("Ошибка при отправке данных в Telegram");return{success:!0,message:"Сообщение успешно отправлено в Telegram."}}catch(l){return console.error("Ошибка при отправке данных в Telegram:",l),{success:!1,message:"Ошибка при отправке данных в Telegram."}}},V=({orderDataSendTelegram:m})=>{const[i,p]=c.useState(""),[t,f]=c.useState({name:x.data.is_fio_form?"":"NotName",phone:"",email:"",message:x.data.is_message_active?"":"Интересует оформление заказа / подробности (форма продукты/услуги)",delivery:"",orderDataSendTelegram:m}),[g,o]=c.useState(!1),[a,h]=c.useState("phone"),[l,v]=c.useState(!1),[b,y]=c.useState(""),d=s=>{const{name:n,value:u}=s.target;n==="phone"&&(u.replace(/\D/g,"").length!==11?p("Номер телефона должен содержать 11 цифр."):p("")),f(S=>({...S,[n]:u}))},j=s=>s.replace(/\D/g,"").length===11,w=a==="email"&&(s=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s))(t.email)||a==="phone"&&j(t.phone),T=t.name.trim()!==""&&t.message.trim()!==""&&(!m.is_delivery||t.delivery.trim()!=="")&&w&&l,N=async s=>{if(s.preventDefault(),!!T){o(!0);try{const n=await M(t);if(o(!0),n.success){const u=new URLSearchParams({name:t.name,phone:t.phone,email:t.email,message:t.message,delivery:t.delivery||r.components.reactComponents.formSendOrderReact.deliveryEmptyMsg}).toString();o(!1),window.location.href=`/thank-you?${u}`}else y(n.message||r.components.reactComponents.formSendOrderReact.errorMessage),o(!1)}catch{y(r.components.reactComponents.formSendOrderReact.errorMessage),o(!1)}}},O=()=>{window.location.href="/"};return e.jsx("div",{className:"fixed text-gray-900 inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md w-80 relative",children:[e.jsx("button",{onClick:()=>O(),className:"absolute top-2 right-2 text-gray-500 hover:text-gray-700",children:e.jsx(R,{size:24})}),e.jsx("h2",{className:"text-lg font-bold mb-4 text-center",children:r.components.reactComponents.formSendOrderReact.title}),e.jsxs("form",{onSubmit:N,children:[e.jsx("input",{type:"text",name:"name",value:t.name,placeholder:r.components.reactComponents.formSendOrderReact.namePlaceholder,onChange:d,className:`${x.data.is_fio_form?"":"hidden"} block w-full p-2 mb-2 border rounded`,required:!0}),e.jsxs("div",{className:"flex space-x-2 mb-2",children:[e.jsx("button",{type:"button",onClick:()=>h("phone"),className:`px-2 py-1 rounded border ${a==="phone"?"bg-blue-500 text-white":"bg-gray-200"}`,children:"Телефон"}),e.jsx("button",{type:"button",onClick:()=>h("email"),className:`px-2 py-1 rounded border ${a==="email"?"bg-blue-500 text-white":"bg-gray-200"}`,children:"Email"})]}),a==="phone"&&e.jsxs(e.Fragment,{children:[e.jsx($,{mask:r.components.reactComponents.callToActionIconReact.formCallToAction.maskPlaceholder,name:"phone",value:t.phone,placeholder:r.components.reactComponents.callToActionIconReact.formCallToAction.phonePlaceholder,onChange:d,className:`block w-full p-2 mb-2 border rounded ${i?"border-red-400 ring-red-100":"border-gray-300 focus:border-gray-600 ring-gray-100"}`,required:!0}),i&&e.jsx("p",{className:"text-red-500",children:i})]}),a==="email"&&e.jsx("input",{type:"email",name:"email",value:t.email,placeholder:r.components.reactComponents.callToActionIconReact.formCallToAction.emailPlaceholder,onChange:d,className:"block w-full p-2 mb-2 border rounded",required:!0}),e.jsx("textarea",{name:"message",value:t.message,placeholder:r.components.reactComponents.formSendOrderReact.messagePlaceholder,onChange:d,className:`${x.data.is_message_active?"":"hidden"} block w-full p-2 mb-2 border rounded`,rows:4}),m.is_delivery&&e.jsx("textarea",{name:"delivery",value:t.delivery,placeholder:r.components.reactComponents.formSendOrderReact.deliveryPlaceholder,onChange:d,className:"block w-full p-2 mb-2 border rounded",required:!0,rows:4}),e.jsxs("div",{className:"flex items-start gap-2 mb-2",children:[e.jsx("input",{type:"checkbox",id:"agreeToTerms",checked:l,onChange:()=>v(!l),className:"mt-1"}),e.jsxs("label",{htmlFor:"agreeToTerms",className:"text-sm",children:["Я соглашаюсь с"," ",e.jsx("a",{href:"/privacy-policy",target:"_blank",className:"text-blue-600 underline",children:"политикой конфиденциальности"})," ","и"," ",e.jsx("a",{href:"/user-agreement",target:"_blank",className:"text-blue-600 underline",children:"пользовательским соглашением"}),"."]})]}),e.jsx(_,{yaGoalTitle:E.yaGoalTitleSendOrder,children:e.jsx("button",{type:"submit",className:`mt-2 w-full px-4 py-2 rounded-md ${T?"bg-blue-500 text-white hover:bg-blue-600":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:e.jsx(k,{loading:g,spinTitleText:r.components.reactComponents.formSendOrderReact.btnSpinnerLoader,titleText:r.components.reactComponents.formSendOrderReact.btnSend})})})]}),b&&e.jsxs("p",{className:"text-red-500",children:[r.components.reactComponents.formSendOrderReact.errorDefaultMessage," ",b]})]})})};export{V as default};
