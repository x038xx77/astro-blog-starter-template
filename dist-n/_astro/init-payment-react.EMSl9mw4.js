import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as m}from"./index.C1SLTdIO.js";import{s as a,a as d,b as i}from"./_slug_.e3f5baab.CMdvpyCo.js";import{a as f}from"./app-config.zEQo3iYE.js";import{R as F}from"./index.n-Ca5uiV.js";const I=async t=>{const n=f.TOKEN_TELEGRAM,c=f.CHAT_ID_TELEGRAM;try{await fetch(`https://api.telegram.org/bot${n}/sendMessage?chat_id=${c}&text=Покупатель ${t?.email_customer||"не указан"}, телефон: ${t?.phone_customer||"не указан"} оплачивает: ${t?.title} на сумму: ${t?.amount} Руб. Заказ №: ${t?.order_id} Указал доставку: ${t?.address_delivery||"не указан"} Банк зачисления ${t.pay_method}`).then(()=>{}).catch(s=>{console.error(s)})}catch{console.log("Error Send TELGRAM API")}},E=({paidProduct:t})=>{const[n,c]=m.useState(null),[s,o]=m.useState(0),u=m.useRef(null),[h,l]=m.useState(!1),N=(t.price-t.price*t.discount/100).toFixed(2);return m.useEffect(()=>{t&&(c(t),t.discount?o(Number(N)):o(t?.amount||0))},[t]),m.useEffect(()=>{const r=document.createElement("script");return r.src="https://securepay.tinkoff.ru/html/payForm/js/tinkoff_v2.js",r.async=!0,r.onload=()=>l(!0),document.body.appendChild(r),()=>{document.body.removeChild(r)}},[]),m.useEffect(()=>{const r=u.current;if(r){const x=p=>{p.preventDefault();const{description:b,amount:y,email:_,phone:g,receipt:v}=r;if(v){if(!_.value&&!g.value){alert("Поле E-mail или Phone не должно быть пустым");return}r.receipt.value=JSON.stringify({EmailCompany:f.TINKOFF_EMAIL_COMPANY,Taxation:f.TINKOFF_TAXION_COMPANY,FfdVersion:"1.2",Items:[{Name:b.value||"Оплата",Price:Number(y.value*100),Quantity:1,Amount:Number(y.value*100),PaymentMethod:"full_prepayment",PaymentObject:"service",Tax:"none",MeasurementUnit:"pc"}]})}if(window.pay){try{const j={email_customer:n?.email_customer||"",pay_method:"t-bank",amount:Number(N)||0,order_id:n?.order_id||"",address_delivery:n?.address_delivery||"",phone_customer:n?.phone_customer||"",fio_customer:n?.fio_customer||"",title:n?.title||""};I(j)}catch{console.log("Error Send Telegram Pay")}window.pay(r)}else console.error("Функция pay не найдена.")};return r.addEventListener("submit",x),()=>{r.removeEventListener("submit",x)}}},[h,n]),e.jsx(e.Fragment,{children:e.jsxs("form",{className:a.formContainer,name:"payform-tinkoff",id:"payform-tinkoff",ref:u,children:[e.jsx("input",{className:a.inputRow,type:"hidden",name:"terminalkey",value:f.TINKOFF_TERMINAL_KEY}),e.jsx("input",{className:a.inputRow,type:"hidden",name:"frame",value:"false"}),e.jsx("input",{className:a.inputRow,type:"hidden",name:"language",value:"ru"}),e.jsx("input",{className:a.inputRow,type:"hidden",name:"receipt",value:""}),e.jsx("label",{htmlFor:"amount",className:`hidden ${a.mb2} ${a.textGray100}`,children:"Сумма заказа"}),e.jsx("input",{className:`hidden ${a.inputRow}`,type:"number",placeholder:"Сумма заказа",name:"amount",value:s,onChange:r=>o(Number(r.target.value)),required:!0}),e.jsx("input",{className:a.inputRow,type:"hidden",name:"order",value:n?.order_id||""}),e.jsx("input",{className:a.inputRow,type:"hidden",name:"description",value:`Заказ №${n?.order_id||""}, Оплатил: ${n?.email_customer||""}, ${n?.title?.slice(0,50)||""}`}),e.jsx("input",{className:a.inputRow,type:"hidden",name:"name",readOnly:!0,value:`${n?.fio_customer||""}`}),e.jsx("input",{className:a.inputRow,type:"hidden",name:"email",value:n?.email_customer||""}),e.jsx("input",{className:a.inputRow,type:"hidden",name:"phone"}),e.jsxs("div",{className:`${a.mb6} ${a.card}`,children:[e.jsx("label",{className:a.cardLabel,children:"Ваш заказ:"}),e.jsx("p",{className:`${a.mb4} ${a.cardText}`,children:e.jsxs("span",{children:["№ ",n?.order_id]})}),e.jsxs("p",{className:`${a.mb4} ${a.cardText}`,children:[e.jsx("label",{className:a.cardLabel,children:"Название товара:"}),e.jsx("span",{className:a.cardTextBold,children:n?.title})]})]}),e.jsxs(e.Fragment,{children:[e.jsx("input",{className:` ${a.inputRow} ${a.submitBtn}`,type:"submit",value:` Оплатить ${s} ₽`}),e.jsx("p",{className:"hidden",children:"Выше можно изменить сумму оплаты!"})]})]})})},C=({paidProduct:t})=>e.jsx(e.Fragment,{children:e.jsx("div",{className:" items-center justify-center  p-3",children:e.jsx("div",{className:"",children:e.jsx("div",{className:"",children:e.jsx(E,{paidProduct:t})})})})}),R=({isOpen:t,onClose:n,payData:c})=>{if(!t)return null;const{product:s,payerData:o,orderId:u}=c,h=s.discount>0?s.price-s.price*s.discount/100:s.price,l={id:u,pay_method:"t-bank",title:s.title,description:c.orderId,price:s.price,discount:s.discount,is_delivery:s.is_delivery,amount:s.price,quantity:1,fio_customer:o?.name,email_customer:o?.email,phone_customer:o?.phone,address_delivery:o?.address,order_id:u};return e.jsx("div",{className:d.modalOverlay,children:e.jsxs("div",{className:d.modalContent,children:[e.jsx("h2",{children:"Оплата"}),e.jsxs("div",{className:d.productInfo,children:[e.jsx("img",{src:s.image.src,alt:s.image.alt,className:d.productImage}),s.discount>0?e.jsxs("p",{className:"text-lg font-bold",children:["Цена:",e.jsxs("span",{className:d.originalPrice,children:[s.price.toFixed(2)," ₽"]}),e.jsx("br",{}),"Со скидкой:  ",e.jsxs("span",{className:d.discountedPrice,children:[h.toFixed(2)," ₽"]})]}):e.jsxs("p",{className:d.price,children:[s.price.toFixed(2)," ₽"]})]}),e.jsx(C,{paidProduct:l}),e.jsx("div",{className:d.modalActions,children:e.jsx("button",{onClick:n,className:d.cancelButton,children:"Отмена"})})]})})},A=({product:t})=>{const{title:n,price:c,discount:s,image:o,is_delivery:u}=t||{},h=s>0?c-c*s/100:c,[l,N]=m.useState({name:"",email:"",phone:"",address:""}),[r,x]=m.useState(!1),p=v=>{const{name:j,value:$}=v.target;N({...l,[j]:$})},y={product:t,payerData:l,orderId:`${new Date().toISOString().replace(/[-:T]/g,"").split(".")[0]}`},_=()=>{x(!0)},g=()=>{x(!1)};return e.jsxs("div",{className:i.container,children:[e.jsxs("div",{className:i.card,children:[e.jsx("h2",{className:i.textBase,children:"Страница оплаты"}),e.jsx("a",{href:"/",className:i.textRed500,children:"На главную"}),t&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:i.productInfo,children:[o.src&&e.jsx("img",{src:o.src,alt:n,className:i.productImage}),e.jsxs("div",{className:i.productDetails,children:[e.jsx("h3",{children:n}),s>0?e.jsxs("p",{children:[e.jsxs("span",{className:i.originalPrice,children:[c.toFixed(2)," ₽"]}),e.jsxs("span",{className:i.discountedPrice,children:[h.toFixed(2)," ₽"]})]}):e.jsxs("p",{className:i.price,children:[c.toFixed(2)," ₽"]}),u&&e.jsx("p",{children:"Требуется доставка"})]})]})}),e.jsxs("form",{children:[e.jsx("h4",{children:"Данные плательщика"}),e.jsx("input",{type:"text",name:"name",placeholder:"ФИО",value:l.name,onChange:p,required:!0,className:i.inputField}),e.jsx("input",{type:"email",name:"email",placeholder:"Email",value:l.email,onChange:p,required:!0,className:i.inputField}),e.jsx(F,{mask:"+7 (999) 999-99-99",name:"phone",value:l.phone,placeholder:"Ваш телефон",onChange:p,className:i.inputField,required:!0}),u&&e.jsx("input",{type:"text",name:"address",placeholder:"Адрес доставки",value:l.address,onChange:p,required:!0,className:i.inputField}),e.jsx("button",{type:"button",onClick:_,className:i.payButton,children:"Подтвердить"})]})]}),e.jsx(R,{isOpen:r,onClose:g,payData:y})]})};export{A as default};
